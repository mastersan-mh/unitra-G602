#ifndef DEFS_H_
#define DEFS_H_

/* button debounce time, ms */
#define DI_DEBOUNCE_TIME (100UL)

/* irq 0 (digital pin 2) */
#define PIN_DI_2_INTERRUPT (0U)
/* irq 1 (digital pin 3) */
#define PIN_DI_3_INTERRUPT (1U)

#define PIN_DI_GAUGE_DRIVE_ROTATEPULSE (2U)
#define PIN_DI_GAUGE_TABLE_ROTATEPULSE (3U)
#define PIN_DI_GAUGE_STOP        (4U)
#define PIN_DI_BTN_45_33    (5U)
#define PIN_DI_BTN_AUTOSTOP (6U)
#define PIN_DI_BTN_START    (7U)
#define PIN_DI_BTN_STOP     (8U)
#define PIN_DO_ENGINE       (9U)
#define PIN_DO_LIFT         (10U)
#define PIN_DO_STROBE_ERROR (11U)
#define PIN_DO_AUDIO_DENY   (12U)

#define PIN_AI_POTENTIOMETER (PIN_A0)

/*
6 = (45 - 33) / 2
27 = 33 - 6
33
39 = 33 + 6 = 45 - 6
45
51 = 45 + 6
*/

#define G602_SPEED_HALF 512 /* full scale of potentiometer = 1024 -> 1024/2 */
#define G602_SPEED_MIN           (0) /* 0 */
#define G602_SPEED_BASELINE_LOW  (G602_SPEED_MIN + G602_SPEED_HALF) /* 1 */
#define G602_SPEED_BASELINE_HIGH (G602_SPEED_BASELINE_LOW + G602_SPEED_HALF * 2) /* 3 */
#define G602_SPEED_MAX           (G602_SPEED_BASELINE_HIGH + G602_SPEED_HALF) /* 4 */

/* Aomount of impulses per rotate */
#define G602_DRIVE_PULSES_PER_ROTATE 6
#define G602_TABLE_PULSES_PER_ROTATE 4

/** @brief Speeds of table, rpm */
#define G602_TABLE_SPEED_LOW_RPM  (33)
#define G602_TABLE_SPEED_HIGH_RPM (45)
#define G602_TABLE_SPEED_MANUAL_RANGE_LOW_RPM  (-( (G602_TABLE_SPEED_HIGH_RPM - G602_TABLE_SPEED_LOW_RPM) / 2) )
#define G602_TABLE_SPEED_MANUAL_RANGE_HIGH_RPM ( ( (G602_TABLE_SPEED_HIGH_RPM - G602_TABLE_SPEED_LOW_RPM) / 2) )

#define RPM_TO_RPH(x) (x * 60)

/** @brief Speeds of table, rph */
#define G602_TABLE_SPEED_LOW_RPH               RPM_TO_RPH(G602_TABLE_SPEED_LOW_RPM)
#define G602_TABLE_SPEED_HIGH_RPH              RPM_TO_RPH(G602_TABLE_SPEED_HIGH_RPM)
#define G602_TABLE_SPEED_MANUAL_RANGE_LOW_RPH  RPM_TO_RPH(G602_TABLE_SPEED_MANUAL_RANGE_LOW_RPM)
#define G602_TABLE_SPEED_MANUAL_RANGE_HIGH_RPH RPM_TO_RPH(G602_TABLE_SPEED_MANUAL_RANGE_HIGH_RPM)

#define G602_TABLE_PULSES_PER_REV 1
#define G602_ENGINE_PULSES_PER_REV 6

/** @brief The pulley diameters multiplied by 10 */
#define G602_TABLE_PULLEY_DIAMETER_MM_MUL10 (1400)
#define G602_ENGINE_PULLEY_DIAMETER_MM_MUL10 (55)

/* 840 rpm */
#define G602_ENGINE_SPEED_LOW_RPM \
        ((G602_TABLE_PULLEY_DIAMETER_MM_MUL10 * G602_TABLE_SPEED_LOW_RPM) / G602_ENGINE_PULLEY_DIAMETER_MM_MUL10)
/*
1400 * 45 / 50 = 1260
1400 * 45 / 55 = 1400 * 9 / 11 = 12600 / 11 = 1145,454545455
1400 * 45 / 60 = 1050
*/
#define G602_ENGINE_SPEED_HIGH_RPM \
        ((G602_TABLE_PULLEY_DIAMETER_MM_MUL10 * G602_TABLE_SPEED_HIGH_RPM) / G602_ENGINE_PULLEY_DIAMETER_MM_MUL10)

/** @brief pulses per minute */
#define G602_TABLE_PULSES_PER_MINUTE_LOW   (G602_TABLE_PULSES_PER_REV * G602_TABLE_SPEED_LOW_RPM)
#define G602_TABLE_PULSES_PER_MINUTE_HIGH  (G602_TABLE_PULSES_PER_REV * G602_TABLE_SPEED_HIGH_RPH)
#define G602_ENGINE_PULSES_PER_MINUTE_LOW  (G602_ENGINE_PULSES_PER_REV * G602_ENGINE_SPEED_LOW_RPM)
#define G602_ENGINE_PULSES_PER_MINUTE_HIGH (G602_ENGINE_PULSES_PER_REV * G602_ENGINE_SPEED_HIGH_RPM)

#define G602_ROTATE_MEASURES__NUM 5

#define G602_SHEDULER_TASKS__NUM 10

#endif
